<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculating the AMF &mdash; BeAMF 100 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/my_theme.css?v=43fd341a" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=19a141df"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BeAMF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Calculating the AMF</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-needed-for-the-amf">What is needed for the AMF</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-of-a-use-case">Example of a use case:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lut">LUT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-files">Input files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-options">Command line options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#auxiliary-data">auxiliary data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#background-correction">Background correction</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BeAMF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Calculating the AMF</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/main.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="calculating-the-amf">
<h1>Calculating the AMF<a class="headerlink" href="#calculating-the-amf" title="Link to this heading"></a></h1>
<section id="what-is-needed-for-the-amf">
<h2>What is needed for the AMF<a class="headerlink" href="#what-is-needed-for-the-amf" title="Link to this heading"></a></h2>
<p>All parameters that can be set should be given in a json file, an example is provided below.
As input the following can be provided:</p>
<ul class="simple">
<li><p>general settings for AMF</p></li>
<li><p>LUT</p></li>
<li><p>Terrain height (optional)</p></li>
<li><p>Albedo (optional)</p></li>
<li><p>Profile (optional)</p></li>
</ul>
<p>Also the output path have to be specified. And a Background correction (optional) can also be provided.</p>
</section>
<section id="example-of-a-use-case">
<h2>Example of a use case:<a class="headerlink" href="#example-of-a-use-case" title="Link to this heading"></a></h2>
<p>A simple example to calculate TROPOMI HCHO AMF based on QDOAS output in Harp format</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>beamf -c harp_hcho.json
</pre></div>
</div>
<p>harp_hcho.json is the configuration file for AMF tool. The general setting includes:</p>
<ol class="arabic simple">
<li><p>molecule(HCHO)</p></li>
<li><p>wavelength (340nm)</p></li>
<li><p>amftrop_flag( including total</p></li>
<li><p>tropospheric and stratospheric AMF calculation),</p></li>
<li><p>vcd_flag(including a VCD conversion=SCD/AMF)</p></li>
<li><p>cldcorr_flag  (including cloud correction)</p></li>
<li><p>sza_max (75, AMF is only calculated for SZA&lt;75 degree).</p></li>
</ol>
<section id="lut">
<h3>LUT<a class="headerlink" href="#lut" title="Link to this heading"></a></h3>
<p>box-AMF and Radiance LUT (as a function of wavelength, pressure grid (normalized by surface pressure), surface pressure, solar zenith angle, viewing zenith angle, relative azimuth angle, and
surface albedo)</p>
</section>
<section id="input-files">
<h3>Input files<a class="headerlink" href="#input-files" title="Link to this heading"></a></h3>
<p>TROPOMI HCHO SCD file with HARP format (file_type=0). The other input variables are not specified, which is defined internally based on “molecule” and “file_type”. All auxiliary data is
pre-calculated (from operational L2 file), and terrain height, albedo, cloud, and profile settings are not required for this case.</p>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Link to this heading"></a></h3>
<p>Append into the same file as input (out_file_mode=out_file_type=0, out_file=””). Output variables include amf, averaging_kernel, cloud_radiance fraction, vcd. Out_var_name only set “cloud_radiance_fraction” = “cloud_radiance_fraction”, the default variable name in HARP is “cloud_fraction”. The other variables are using default name based on HARP format.</p>
<p>It will take ~5 min to process one orbit of TROPOMI data.</p>
</section>
</section>
<section id="command-line-options">
<h2>Command line options<a class="headerlink" href="#command-line-options" title="Link to this heading"></a></h2>
<p>In addition, variables in configuration file can be modified by command line as well, for example:</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>&gt; beamf -c harp_hcho.json -w 350.0
</pre></div>
</div>
<p>AMF calculation uses 350nm instead 340nm (settings in configuration file)</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>&gt; bamf -c harp_hcho.json -i ./2022/07/01/S5P_RPRO_L1B_RA_BD3_20220701T024730_20220701T042859_24427_03_020100_20230104T141057_w320_h2co_radasref.nc
</pre></div>
</div>
<p>Command line options have precedence over json config file.</p>
</section>
<section id="auxiliary-data">
<h2>auxiliary data<a class="headerlink" href="#auxiliary-data" title="Link to this heading"></a></h2>
<p>The auxiliary data can be calculated in the AMF tool (interpolated from gridded data into the satellite pixels), this can be done by settings input information in surface pressure, profile etc.</p>
</section>
<section id="background-correction">
<h2>Background correction<a class="headerlink" href="#background-correction" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>based on configuration file “harp_hcho_bc.json”.</p></li>
<li><p>bc_flag or sts_flag = True: background correction or stratospheric correction based on the reference sector method (sts_flag: data analysis based on SCD/geometric AMF; bc_flag: data analysis based    on SCD).</p></li>
<li><p>inp_file = “./2022/07/01/*.nc”. Background correction is only based on the daily satellite measurement (at least 10 files)</p></li>
<li><p>bc_test_flag = True: visualized the fitting results. (if you want to do data process, this flag should be switch off)</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>harp name</p></th>
<th class="head"><p>unit attribute</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HCHO_column_number_density_amf</p></td>
<td><p>1</p></td>
<td><p>amf of hcho</p></td>
</tr>
<tr class="row-odd"><td><p>HCHO_column_number_density_avk</p></td>
<td><p>1</p></td>
<td><p>vcd of hcho</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>